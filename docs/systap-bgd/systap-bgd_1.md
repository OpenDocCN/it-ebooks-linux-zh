# 介绍

# 1\. 介绍

SystemTap 是一种允许用户研究和监控操作系统（尤指 Linux 内核）运行细节的跟踪/剖析工具。SystemTap 可以像`netstat`，`ps`，`top`和`iostat`那样统计系统数据；不止于此，为了收集信息，它还提供了更多过滤和分析的途径。

# 编写本文档的目标

# 1.1\. 编写本文档的目标

SystemTap 允许使用者监控 Linux 系统当前的运行情况，以便进一步分析。这将有助于运维或开发人员缉查 bug 或性能问题的罪魁祸首。

在 SystemTap 开发出来之前，要想监控一个运行中的内核，有些时候需要注入检测代码（instrument），重新编译，安装，还要重启一下。SystemTap 的诞生，把程序员从这一串繁琐的步骤中解放出来。现在要想完成同样的工作，你只需要简单地运行下自己写的 SystemTap 脚本。

不过，SystemTap 的目标用户是那些对内核驾轻就熟的老手。对于内核菜鸟来说，SystemTap 依旧难以上手。雪上加霜的是，现存的许多 SystemTap 文档都假定读者有相当丰富的内核经验，这使得学习 SystemTap 的路途道阻且长。

为了降低入门的门槛，我们编写了《SystemTap 新手指南》。它包括下面的内容：

1.  介绍 SystemTap 和它的用法，并列出各种型号内核下的安装方式。
2.  提供监控系统各组件的运行详情的 SystemTap 脚本作为例子，并介绍它们的运行方式和分析其输出。

# SystemTap 的能力

# 1.2\. SystemTap 的能力

**灵活性**：SystemTap 提供了一门领域特定语言，使得用户可以编写自定义脚本，调查和监控各种内核函数、系统调用，和其它发生在内核空间的事件。就此而言，SystemTap 不仅仅是个工具，它是一个让你能够自定义内核取证和监控工具的生态系统。

**易于上手**：正如前面谈到的，SystemTap 把用户从在探测内核空间事件时，注入检测代码-重新编译-安装-重启这一繁琐过程解放出来。

我们在第五章——SystemTap 脚本集锦——列出的大多数 SystemTap 脚本所展现出的系统取证和监控能力，是其它同类型工具（比如`top`，`oprofile`，`ps`）所不能及的。这些脚本很好地诠释了 SystemTap 强大的功能，届时将会拓宽诸位读者编写自己的 SystemTap 脚本时的眼界。

# SystemTap 的局限

# 1.3\. SystemTap 的局限

当前版本的 SystemTap 提供的探测内核空间事件的众多选项，可以在不同版本的内核下使用。然而，SystemTap 对探测用户空间事件的支持依赖于内核的支持（需要 utrace 机制），而多数内核缺乏这一支持。结果是，仅有部分内核上的 SystemTap 版本支持用户空间探测。 当前，SystemTap 社区正集中力量改进 SystemTap 的用户空间探测能力。 （译注：本指南写于 2013 年。现今的内核普遍已经支持用户空间探测，旧的内核用的是 utrace，新的内核用的是 uprobes）